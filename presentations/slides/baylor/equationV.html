<!DOCTYPE html>
<meta charset="utf-8">
<head>
<style>
    @import url('../../static/style/slide.css');

    body {
      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      position: relative;
      width: 960px;
    }

    .axis path,
    .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
        font: 20px;
    }

    
    text {
        font: 20px sans-serif;
    }
    
    .x.axis path {
        display: none;
    }
    
    .line {
        fill: none;
        stroke: black;
        stroke-width: 1.5px;
    }
    .inputholder {
        font-size: 24px;
    }
    .line2 {
        fill: none;
        stroke: #00ff80;
        stroke-width: 1.5px;
    }
    .line3  {
        fill: none;
        stroke: #ff0000;
        stroke-width: 1.5px;
    }
    #info {
        font-size: 24px;}
</style>

<script type="text/javascript"
  src="https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<script type="text/javascript" src="http://d3js.org/d3.v3.js"></script>
</head>

  <body>
    <h2 class="slideTitle"> equation 5: spectral univariance</h2>
    <div class="JAX">
	  \[\begin{aligned}
	  r  = r_{m}(1-e^{-ki}),
	  \end{aligned} \]
   </div>
      <script>
          
          var margin = {top: 50, right: 50, bottom: 80, left: 70},
          width = 960 - margin.left - margin.right,
          height = 500 - margin.top - margin.bottom;

          
          var x = d3.scale.log()
          .range([10, width + 10]);
          
          var y = d3.scale.linear()
          .range([height - 30, -30]);
          
          var xAxis = d3.svg.axis()
          .scale(x)
          .ticks(5)
          .orient("bottom");
          
          var yAxis = d3.svg.axis()
          .scale(y)
          .orient("left");
         
          var k = 0.00027;
          
          var xVal = d3.range(Math.pow(10,2),Math.pow(10,6), 100);
          var yVal = function(x,R_m,k) {
                               return (R_m * ( 1 - Math.pow(Math.E,(-k*x))));
                };

          var data = [];
          for (i=0;  i < xVal.length; i++) {
              data.push({"x": xVal[i], "y": yVal(xVal[i], 20, 0.00027)});
          };
          
         
          var line = d3.svg.line()
          .x(function(d) { return x(d.x); })
          .y(function(d) { return y(d.y); });

          var line2 = d3.svg.line()
          .x(function(d) { return x(d.x); })
          .y(function(d) { return y(d.y); });
          
          var line3 = d3.svg.line()
          .x(function(d) { return x(d.x); })
          .y(function(d) { return y(d.y); });

          var svg = d3.select("body").append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
          .append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
                 
          x.domain(d3.extent(data, function(d) { return d.x; }));
          y.domain(d3.extent(data, function(d) { return d.y; }));
          
          svg.append("g")
                 .attr("class", "x axis")
                 .attr("transform", "translate(0," + height + ")")
                 .call(xAxis)
                 .append("text")
                 .attr("x", width / 2)
                 .attr("y", 65)
                 .text("flash photon density (photons um^-2)");
                 
          svg.append("g")
                 .attr("class", "y axis")
                 .call(yAxis)
                 .append("text")
                 .attr("transform", "rotate(-90)")
                 .attr("y", 6)
                 .attr("dy", ".71em")
                 .style("text-anchor", "end")
                 .text("peak response (pA)");

          svg.append("path")
                 .datum(data)
                 .attr("class", "line2")
                 .attr("d", line2);  

          svg.append("path")
                 .append("text")
                 .text("500 nm");

          var data = [];
          for (i=0;  i < xVal.length; i++) {
              data.push({"x": xVal[i], "y": yVal(xVal[i], 20, 0.0000301)});
          };
          
          svg.append("path")
                 .datum(data)
                 .attr("class", "line3")
                 .attr("d", line3);    

  
          var data = [];
          for (i=0;  i < xVal.length; i++) {
              data.push({"x": xVal[i], "y": yVal(xVal[i], 20, 0.000097)});
          };                 
          svg.append("path")
                 .datum(data)
                 .attr("class", "line")
                 .attr("d", line);


          d3.select("body")
                .append("div")
                 .attr("class","inputholder")
                .append("input")
                 .attr("type", "range")
                 .attr("min", 1* Math.pow(10,-6))
                 .attr("max", 1* Math.pow(10,-3.25))
                 .attr("step", 0.000005)
                 .attr("value", 9.7 * Math.pow(10,-5))

          d3.select(".inputholder").append("span")
              .attr("id", "k_text")
              .text("$k$: ")
              .append("span")
              .attr("id", "k_val")
              .text(9.7 * Math.pow(10,-5));

          d3.select("input").on("change", change);
          
          function change() {
                d3.select("#k_val").remove()         
                d3.select(".inputholder").append("span")
                 .attr("id", "k_val")
                 .text(this.value);
                
                d3.select(".line").remove()
                console.log(this.value);
                
                k = this.value;
                var data = []

                for (i=0;  i < xVal.length; i++) {
                  data.push({"x": xVal[i], "y": yVal(xVal[i], 20, k)});
                  };

                svg.append("path")
                 .datum(data)
                 .attr("class", "line")
                 .attr("d", line);
            };

          </script>
    <div id="info"> $r_m$ = 20, controls heigh of y axis </div>
  </body>
</html>
